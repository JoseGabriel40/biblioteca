<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Biblioteca - Web</title>
  <link rel="stylesheet" href="styles.css">

  <script src="login-script.js"></script>

</head>
<body>
<script>
  // ESSENCIAL: Se o login-script.js n√£o tiver definido a sess√£o (ou houver falha), redireciona.
  if (!window.USER_SESSION) {
    window.location.href = 'login.html';
  }
</script>

<div class="app-container">
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="library-icon">üìö</div>
      <h2>Biblioteca Web</h2>
    </div>
    <ul class="nav-menu">
      <li class="nav-item active" data-tab="dashboard">
        <div class="nav-icon">üìä</div>
        <span>Dashboard</span>
      </li>
      <li class="nav-item" data-tab="books">
        <div class="nav-icon">üìñ</div>
        <span>Livros</span>
      </li>
      <li class="nav-item" data-tab="users">
        <div class="nav-icon">üë•</div>
        <span>Usu√°rios</span>
      </li>
      <li class="nav-item" data-tab="loans">
        <div class="nav-icon">üîñ</div>
        <span>Empr√©stimos</span>
      </li>
      <li class="nav-item" data-tab="reports">
        <div class="nav-icon">üìà</div>
        <span>Relat√≥rios</span>
      </li>
      <li class="nav-item" data-tab="settings">
        <div class="nav-icon">‚öôÔ∏è</div>
        <span>Configura√ß√µes</span>
      </li>
    </ul>
  </div>

  <div class="main-content">
    <div class="header">
      <h1 id="section-title">Dashboard</h1>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">A</div>
        <span id="userNameDisplay">Administrador</span>
        <button class="btn btn-danger" id="logoutBtn">
          <span>üö™</span>
          Sair
        </button>
      </div>
    </div>

    <div class="tab-content active" id="dashboard">
      <div class="dashboard-cards">
        <div class="card fade-in"><div class="card-header"><span class="card-label">Livros Cadastrados</span><span class="card-icon">üìö</span></div><div class="card-value" id="booksCount">0</div><div class="card-label">Total no sistema</div></div>
        <div class="card fade-in"><div class="card-header"><span class="card-label">Empr√©stimos Ativos</span><span class="card-icon">üîñ</span></div><div class="card-value" id="loansCount">0</div><div class="card-label">Em andamento</div></div>
        <div class="card fade-in"><div class="card-header"><span class="card-label">Usu√°rios Cadastrados</span><span class="card-icon">üë•</span></div><div class="card-value" id="usersCount">0</div><div class="card-label">Alunos e funcion√°rios</div></div>
        <div class="card fade-in"><div class="card-header"><span class="card-label">Devolu√ß√µes Pendentes</span><span class="card-icon">‚è±Ô∏è</span></div><div class="card-value" id="pendingReturns">0</div><div class="card-label">Com atraso</div></div>
      </div>

      <div class="table-container fade-in">
        <div class="table-header">
          <h2>Empr√©stimos Recentes</h2>
          <button class="btn btn-primary" id="newLoanBtn"><span>‚ûï</span>Novo Empr√©stimo</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>Usu√°rio</th><th>Livro</th><th>Data Empr√©stimo</th><th>Data Devolu√ß√£o</th><th>Status</th></tr></thead>
          <tbody id="loanTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="books">
      <div class="form-container fade-in"><h2>Cadastrar Novo Livro</h2><form id="bookForm"><div class="form-grid">
        <div class="form-group"><label class="form-label">T√≠tulo</label><input type="text" class="form-control" name="title" placeholder="Digite o t√≠tulo do livro" required></div>
        <div class="form-group"><label class="form-label">Autor</label><input type="text" class="form-control" name="author" placeholder="Digite o nome do autor" required></div>
        <div class="form-group"><label class="form-label">Editora</label><input type="text" class="form-control" name="publisher" placeholder="Digite a editora"></div>
        <div class="form-group"><label class="form-label">Ano de Publica√ß√£o</label><input type="number" class="form-control" name="year" placeholder="Digite o ano"></div>
        <div class="form-group"><label class="form-label">ISBN</label><input type="text" class="form-control" name="isbn" placeholder="Digite o ISBN"></div>
        <div class="form-group"><label class="form-label">Categoria</label><select class="form-control" name="category"><option value="">Selecione uma categoria</option><option value="literatura">Literatura</option><option value="ciencia">Ci√™ncia</option><option value="tecnologia">Tecnologia</option><option value="historia">Hist√≥ria</option><option value="ficcao">Fic√ß√£o</option><option value="nao-ficcao">N√£o Fic√ß√£o</option><option value="biografia">Biografia</option><option value="poesia">Poesia</option><option value="autoajuda">Autoajuda</option><option value="infantil">Infantil</option></select></div>
        <div class="form-group"><label class="form-label">Quantidade</label><input type="number" class="form-control" name="quantity" placeholder="Digite a quantidade" required></div>
      </div><div class="form-actions"><button type="submit" class="btn btn-primary">Salvar</button><button type="reset" class="btn btn-danger">Cancelar</button></div></form></div>

      <div class="table-container fade-in" style="margin-top: 30px;">
        <div class="table-header">
          <h2>Livros Cadastrados</h2>
          <div class="search-box-inline"><input type="text" class="search-input" id="bookSearchInput" placeholder="Pesquisar livro por t√≠tulo/autor..."></div>
        </div>
        <table>
          <thead><tr><th>ID</th><th>T√≠tulo</th><th>Autor</th><th>Categoria</th><th>Ano</th><th>Qtd. Total</th><th>Dispon√≠vel</th><th>A√ß√µes</th></tr></thead>
          <tbody id="booksTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="users">
      <div class="form-container fade-in" id="userFormContainer">
        <h2>Cadastrar Novo Usu√°rio</h2>
        <form id="userForm"><div class="form-grid">
          <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-control" name="name" placeholder="Digite o nome" required></div>
          <div class="form-group"><label class="form-label">Ano</label><input type="number" class="form-control" name="year" placeholder="Digite o ano" required></div>
          <div class="form-group"><label class="form-label">Turma</label><input type="text" class="form-control" name="class" placeholder="Digite a turma" required></div>
          <div class="form-group"><label class="form-label">Curso</label><select class="form-control" name="course" required><option value="">Selecione um curso</option><option value="redes">Redes</option><option value="desenvolvimento">Desenvolvimento</option><option value="zootecnia">Zootecnia</option><option value="enfermagem">Enfermagem</option></select></div>
          <div class="form-group" id="roleGroup"><label class="form-label">Papel (Role)</label><select class="form-control" name="role" required><option value="common">Comum (Aluno/Funcion√°rio)</option><option value="admin">Administrador (M√°x. 1)</option></select></div>
        </div><div class="form-actions"><button type="submit" class="btn btn-primary">Salvar</button><button type="reset" class="btn btn-danger">Cancelar</button></div></form></div>

      <div class="table-container fade-in" style="margin-top: 30px;">
        <div class="table-header">
          <h2>Usu√°rios Cadastrados</h2>
          <div class="search-box-inline"><input type="text" class="search-input" id="userSearchInput" placeholder="Pesquisar usu√°rio por nome/curso..."></div>
        </div>
        <table>
          <thead><tr><th>ID</th><th>Nome</th><th>Email</th><th>Curso</th><th>Papel</th><th>A√ß√µes</th></tr></thead>
          <tbody id="usersTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="loans">
      <div class="table-container fade-in">
        <div class="table-header">
          <h2>Todos os Empr√©stimos</h2>
          <button class="btn btn-primary" id="newLoanTabBtn"><span>‚ûï</span>Novo Empr√©stimo</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>Usu√°rio</th><th>Livro</th><th>Data Empr√©stimo</th><th>Data Devolu√ß√£o Prevista</th><th>Status</th><th>Multa</th><th>A√ß√µes</th></tr></thead>
          <tbody id="activeLoanTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="reports">
      <div class="form-container fade-in" style="margin-bottom: 20px;">
        <h2>Filtro de Devolu√ß√µes</h2>
        <form id="reportFilterForm">
          <div class="form-grid" style="grid-template-columns: 1fr 1fr 150px;">
            <div class="form-group"><label class="form-label">Data Inicial (Devolu√ß√£o)</label><input type="date" class="form-control" name="start_date" id="reportStartDate"></div>
            <div class="form-group"><label class="form-label">Data Final (Devolu√ß√£o)</label><input type="date" class="form-control" name="end_date" id="reportEndDate"></div>
            <div class="form-group" style="align-self: flex-end;"><button type="submit" class="btn btn-primary" style="width: 100%;">Filtrar</button></div>
          </div>
        </form>
      </div>

      <div class="table-container fade-in">
        <h2>Relat√≥rio: Livros Emprestados e Devolvidos</h2>
        <table>
          <thead><tr><th>ID Empr√©stimo</th><th>Usu√°rio</th><th>Livro</th><th>Data Empr√©stimo</th><th>Data Devolu√ß√£o</th></tr></thead>
          <tbody id="returnedReportsTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="settings">
      <div class="form-container fade-in">
        <h2>Configura√ß√µes do Sistema</h2>
        <form id="settingsForm">
          <div class="form-group"><label class="form-label">Dias para Devolu√ß√£o (dias)</label><input type="number" class="form-control" id="daysForReturn" name="days_for_return" min="1" required></div>
          <div class="form-group"><label class="form-label">Multa por Atraso (R$ por dia)</label><input type="number" class="form-control" id="finePerDay" name="fine_per_day" step="0.01" min="0" required></div>
          <div class="form-group"><label class="form-label">Notificar dias antes do vencimento (dias)</label><input type="number" class="form-control" id="notificationDays" name="notification_days" min="0" required></div>
          <div class="form-actions"><button type="submit" class="btn btn-primary">Salvar Configura√ß√µes</button></div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="loanModal">
  <div class="modal" style="max-width: 500px;">
    <div class="modal-header">
      <h2>Novo Empr√©stimo</h2>
      <button class="modal-close" id="closeModal">&times;</button>
    </div>
    <form id="loanForm">

      <div class="form-group">
        <label class="form-label">Buscar Usu√°rio por Nome</label>
        <input type="text" class="form-control" id="userNameSearch" placeholder="Digite o nome do usu√°rio" required>
        <div class="search-results-mini" id="userLoanSearchResults"></div>
      </div>

      <div class="form-group">
        <label class="form-label">ID do Usu√°rio Selecionado</label>
        <input type="text" class="form-control" id="loanUserId" placeholder="ID ser√° preenchido automaticamente" readonly required>
      </div>

      <div class="form-group">
        <label class="form-label">ID do Livro</label>
        <input type="text" class="form-control" id="loanBookId" placeholder="Digite o ID do livro" required>
      </div>

      <div class="form-group">
        <label class="form-label">Data de Devolu√ß√£o Prevista (Opcional)</label>
        <input type="date" class="form-control" id="loanReturnDate">
      </div>

      <div class="form-actions"><button type="submit" class="btn btn-success">Registrar Empr√©stimo</button></div>
    </form>
  </div>
</div>

<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="editModalTitle">Editar Registro</h2>
      <button class="modal-close" id="closeEditModal">&times;</button>
    </div>
    <form id="editForm">
      <input type="hidden" id="editId" name="id">
      <div id="editFieldsContainer"></div>
      <div class="form-actions" style="margin-top: 20px;"><button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button></div>
    </form>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
